<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ—¶é—´è½´æ ¡å‡†å·¥å…·</title>
<style>
body{
  font-family:'PingFang SC','Microsoft YaHei',sans-serif;
  max-width:900px;margin:40px auto;padding:20px;
  background:#f5f5f5;
}
h1{color:#333;border-bottom:3px solid #FFD300;padding-bottom:10px}
.container{background:#fff;padding:30px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.1)}
.audio-player{
  margin:20px 0;padding:20px;background:#f9f9f9;border-radius:5px;
  border-left:4px solid #FFD300;
}
.audio-player audio{width:100%;margin:10px 0}
.timer{
  font-size:48px;font-weight:bold;color:#E8302B;
  font-variant-numeric:tabular-nums;text-align:center;
  margin:20px 0;padding:20px;background:#fff;border-radius:5px;
  border:2px solid #E8302B;
}
.scenes{margin-top:30px}
.scene{
  padding:15px;margin:10px 0;background:#f9f9f9;border-radius:5px;
  border-left:4px solid #ccc;cursor:pointer;transition:all 0.2s;
}
.scene:hover{background:#fff;border-left-color:#FFD300}
.scene.active{background:#fffbea;border-left-color:#FFD300;font-weight:bold}
.scene.marked{background:#e8f5e9;border-left-color:#4caf50}
.scene-num{
  display:inline-block;width:50px;font-weight:bold;color:#666;
}
.scene-text{color:#333;margin-left:10px}
.scene-time{
  float:right;color:#999;font-size:14px;
  background:#fff;padding:2px 8px;border-radius:3px;
}
.scene-time.set{color:#4caf50;font-weight:bold}
.controls{
  margin:20px 0;display:flex;gap:10px;justify-content:center;
}
.controls button{
  padding:12px 24px;font-size:16px;border:none;border-radius:5px;
  cursor:pointer;background:#FFD300;color:#000;font-weight:bold;
  transition:all 0.2s;
}
.controls button:hover{background:#E8C000;transform:translateY(-2px)}
.controls button:active{transform:translateY(0)}
.export{
  margin-top:30px;padding:20px;background:#f0f0f0;border-radius:5px;
}
.export textarea{
  width:100%;height:200px;font-family:monospace;font-size:12px;
  padding:10px;border:1px solid #ddd;border-radius:3px;
}
.export button{
  margin-top:10px;padding:10px 20px;background:#E8302B;color:#fff;
  border:none;border-radius:5px;cursor:pointer;font-weight:bold;
}
.export button:hover{background:#c02820}
.instructions{
  background:#e3f2fd;padding:15px;border-radius:5px;
  margin-bottom:20px;border-left:4px solid #2196f3;
}
.instructions h3{margin-top:0;color:#1976d2}
.instructions ol{margin:10px 0;padding-left:25px}
.instructions li{margin:5px 0}
</style>
</head>
<body>
<div class="container">
<h1>â±ï¸ æ—¶é—´è½´æ ¡å‡†å·¥å…·</h1>

<div class="instructions">
<h3>ä½¿ç”¨è¯´æ˜</h3>
<ol>
<li>ç‚¹å‡»"æ’­æ”¾éŸ³é¢‘"ï¼Œå¼€å§‹æ’­æ”¾</li>
<li>å¬åˆ°æ¯å¥è¯<strong>å¼€å§‹è¯´</strong>çš„æ—¶å€™ï¼Œç‚¹å‡»å¯¹åº”çš„åœºæ™¯è¡Œï¼ˆæˆ–æŒ‰æ•°å­—é”®1-9/0/-/=ï¼‰</li>
<li>è®°å½•å®Œæ‰€æœ‰æ—¶é—´ç‚¹åï¼Œç‚¹å‡»"ç”ŸæˆTimelineä»£ç "</li>
<li>å¤åˆ¶ä»£ç ï¼Œç²˜è´´åˆ°å­—å¹•demo_v5.htmlä¸­</li>
</ol>
</div>

<div class="audio-player">
<strong>éŸ³é¢‘æ’­æ”¾å™¨</strong>
<audio id="audio" controls>
<source src="AIDOCS/äººå‡å­˜æ¬¾_Kevin_1.5x.wav" type="audio/wav">
</audio>
<div class="timer" id="timer">0:00.00</div>
</div>

<div class="controls">
<button onclick="resetAll()">ğŸ”„ é‡ç½®æ‰€æœ‰æ—¶é—´ç‚¹</button>
<button onclick="exportTimeline()">ğŸ“‹ ç”ŸæˆTimelineä»£ç </button>
</div>

<div class="scenes" id="scenes">
<!-- åœºæ™¯åˆ—è¡¨ç”±JSç”Ÿæˆ -->
</div>

<div class="export" id="export" style="display:none">
<h3>ç”Ÿæˆçš„Timelineä»£ç </h3>
<textarea id="output" readonly></textarea>
<button onclick="copyCode()">å¤åˆ¶ä»£ç </button>
</div>
</div>

<script>
const scenes = [
  {id:'s1', num:1, text:'å‚¨è“„èŠ‚èŠ‚é«˜ï¼Œè´Ÿå€ºå±‚å±‚å‹', key:'1'},
  {id:'s2', num:2, text:'2025å¹´ä¸ŠåŠå¹´ï¼Œå…¨å›½å±…æ°‘äººå‡å­˜æ¬¾ï¼Œå†åˆ›å†å²æ–°é«˜', key:'2'},
  {id:'s3', num:3, text:'äººå‡å­˜æ¬¾ä½™é¢ï¼Œ13ä¸‡6800å…ƒ', key:'3'},
  {id:'s4', num:4, text:'å¬èµ·æ¥æ˜¯å¥½äº‹ï¼Œå¯¹å§ï¼Ÿ', key:'4'},
  {id:'s5', num:5, text:'ç¬¬ä¸€ï¼Œè¡¨é¢æ˜¯å‚¨è“„æ„æ„¿å¢å¼ºï¼Œå®é™…æ˜¯æ¶ˆè´¹ä¿¡å¿ƒä¸è¶³', key:'5'},
  {id:'s6', num:6, text:'ç¬¬äºŒï¼Œé’±ä¸æ˜¯å­˜åœ¨é“¶è¡Œé‡Œï¼Œè€Œæ˜¯èº²åœ¨é“¶è¡Œé‡Œ', key:'6'},
  {id:'s7', num:7, text:'ä¸ŠåŠå¹´å…³é—­é—¨åº—ï¼Œ161ä¸‡å®¶ï¼Œæ¯å¤©8800å®¶', key:'7'},
  {id:'s8', num:8, text:'ç¬¬ä¸‰ï¼Œç»æµå¥½çš„æ—¶å€™ï¼Œå®å¯çŠ¯é”™ä¸èƒ½é”™è¿‡ï¼Œç»æµå·®çš„æ—¶å€™ï¼Œå®å¯é”™è¿‡ä¸èƒ½çŠ¯é”™', key:'8'},
  {id:'s9', num:9, text:'ä½†è¿™è¿˜å¹¶ä¸æ˜¯æœ€é‡è¦çš„', key:'9'},
  {id:'s10', num:10, text:'çœŸæ­£é‡è¦çš„æ˜¯ï¼Œå®ˆä½ç°é‡‘æµï¼Œå¤šå­˜é’±å°‘æ¬ é’±', key:'0'},
  {id:'s11', num:11, text:'è¿™ä¹Ÿæ˜¯çŸ­æœŸéœ‡åŠ¨ï¼Œç›¸ä¿¡ç»è¿‡ä¸æ–­åŠªåŠ›ï¼Œæœªæ¥ä¸€å®šè¶Šæ¥è¶Šå¥½', key:'-'},
];

const audio = document.getElementById('audio');
const timer = document.getElementById('timer');
const scenesDiv = document.getElementById('scenes');
const timestamps = {};

// æ¸²æŸ“åœºæ™¯åˆ—è¡¨
scenes.forEach(s=>{
  const div = document.createElement('div');
  div.className = 'scene';
  div.id = `scene-${s.id}`;
  div.innerHTML = `
    <span class="scene-num">S${s.num}</span>
    <span class="scene-text">${s.text}</span>
    <span class="scene-time" id="time-${s.id}">æœªè®¾ç½®</span>
  `;
  div.onclick = ()=>markTime(s.id);
  scenesDiv.appendChild(div);
});

// éŸ³é¢‘æ’­æ”¾æ—¶æ›´æ–°è®¡æ—¶å™¨
audio.addEventListener('timeupdate',()=>{
  const t = audio.currentTime;
  const m = Math.floor(t/60);
  const s = (t%60).toFixed(2);
  timer.textContent = `${m}:${s.padStart(5,'0')}`;
});

// æ ‡è®°æ—¶é—´ç‚¹
function markTime(sid){
  const t = audio.currentTime;
  timestamps[sid] = t;
  document.getElementById(`time-${sid}`).textContent = formatTime(t);
  document.getElementById(`time-${sid}`).classList.add('set');
  document.getElementById(`scene-${sid}`).classList.add('marked');
}

function formatTime(t){
  return t.toFixed(2)+'s';
}

// é”®ç›˜å¿«æ·é”®
document.addEventListener('keydown',e=>{
  if(e.code==='Space'){e.preventDefault();audio.paused?audio.play():audio.pause()}
  const scene = scenes.find(s=>s.key===e.key);
  if(scene) markTime(scene.id);
});

// é‡ç½®
function resetAll(){
  if(!confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ—¶é—´ç‚¹å—ï¼Ÿ'))return;
  Object.keys(timestamps).forEach(k=>delete timestamps[k]);
  document.querySelectorAll('.scene-time').forEach(el=>{
    el.textContent='æœªè®¾ç½®';
    el.classList.remove('set');
  });
  document.querySelectorAll('.scene').forEach(el=>el.classList.remove('marked'));
  document.getElementById('export').style.display='none';
}

// ç”ŸæˆTimelineä»£ç 
function exportTimeline(){
  const sorted = scenes.map(s=>({
    id:s.id,
    num:s.num,
    start:timestamps[s.id]||0
  })).sort((a,b)=>a.start-b.start);

  // è®¡ç®—duration
  const timeline = sorted.map((s,i)=>{
    const nextStart = i<sorted.length-1 ? sorted[i+1].start : 37.25;
    return {
      ...s,
      duration: nextStart - s.start
    };
  });

  // ç”Ÿæˆä»£ç 
  let code = 'const timeline = [\n';
  timeline.forEach(s=>{
    code += `  ['${s.id}', ${s.start.toFixed(2)}, ${s.duration.toFixed(2)}, [\n`;

    // æ ¹æ®åœºæ™¯æ·»åŠ åŠ¨ç”»
    if([1,4,9].includes(s.num)){
      code += `    [0,    '#${s.id} .fade:nth-child(1)', 'fade'],\n`;
      code += `    [0.4,  '#${s.id} .fade:nth-child(2)', 'fade'],\n`;
    }else if([3,7].includes(s.num)){
      code += `    [0,    '#${s.id} .fade', 'fade'],\n`;
      code += `    [0.3,  '#${s.id} .pop', 'pop'],\n`;
      code += `    [0.5,  '#counter${s.num===3?1:2}', 'counter:${s.num===3?136800:161}'],\n`;
      if(s.num===7){
        code += `    [1.6,  '#${s.id} .fade:nth-child(3)', 'fade'],\n`;
      }
    }else if([5,6].includes(s.num)){
      code += `    [0,    '#${s.id} .fade:nth-child(1)', 'fade'],\n`;
      code += `    [0.5,  '#${s.id} .fade:nth-child(2)', 'fade'],\n`;
      code += `    [1.2,  '#${s.id} .fade:nth-child(3)', 'fade'],\n`;
    }else if(s.num===8){
      code += `    [0,    '#${s.id} .fade:nth-child(1)', 'fade'],\n`;
      code += `    [0.4,  '#${s.id} .fade:nth-child(2)', 'fade'],\n`;
      code += `    [0.8,  '#${s.id} .fade:nth-child(3)', 'fade'],\n`;
      code += `    [2.5,  '#${s.id} .fade:nth-child(4)', 'fade'],\n`;
      code += `    [2.9,  '#${s.id} .fade:nth-child(5)', 'fade'],\n`;
    }else if(s.num===9){
      code += `    [0,    '#${s.id} .pop:nth-child(1)', 'pop'],\n`;
      code += `    [0.4,  '#${s.id} .pop:nth-child(2)', 'pop'],\n`;
    }else{
      code += `    [0,    '#${s.id} .fade:nth-child(1)', 'fade'],\n`;
      code += `    [0.3,  '#${s.id} .fade:nth-child(2)', 'fade'],\n`;
      code += `    [0.6,  '#${s.id} .fade:nth-child(3)', 'fade'],\n`;
    }

    code += `  ]],\n`;
  });
  code += '];\n\nconst TOTAL = 37.25;';

  document.getElementById('output').value = code;
  document.getElementById('export').style.display = 'block';
  document.getElementById('output').scrollIntoView({behavior:'smooth'});
}

function copyCode(){
  const textarea = document.getElementById('output');
  textarea.select();
  document.execCommand('copy');
  alert('ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
}
</script>
</body>
</html>
