# 工具集

对话短剧制作工具链。

---

## 快速开始

```bash
# 一键生成（推荐）
python3 工具/一键生成.py 剧集/第X集_标题/ 剧本.txt
```

---

## 工具列表

| 工具 | 用途 | 输入 | 输出 |
|------|------|------|------|
| 一键生成.py | 完整流程一键执行 | 起始帧+剧本 | 成品视频 |
| 生成视频素材.py | 从定装照生成对话视频 | 起始帧.png | 橘猫说话.mp4 + 白猫说话.mp4 |
| 生成TTS.py | 从剧本生成语音 | 剧本.txt | 音频/*.mp3 + 剧本.json |
| 合成脚本.py | 合成最终视频 | 剧本.json + 素材 | 成品/xxx_demo.mp4 |

---

## 详细用法

### 1. 一键生成.py

完整流程一键执行，适合快速制作。

```bash
python3 工具/一键生成.py <剧集目录> [剧本文件]

# 示例
python3 工具/一键生成.py 项目/橘猫和白猫/剧集/第五集_新剧/ 剧本.txt
```

**前置条件**：
- `剧集目录/起始帧.png` - 定装照
- `剧本.txt` - 剧本文件

**自动执行**：
1. 生成视频素材（如果不存在）
2. 生成TTS语音
3. 保存剧本.json
4. 合成最终视频

---

### 2. 生成视频素材.py

从定装照生成两条对话视频。

```bash
python3 工具/生成视频素材.py <剧集目录>

# 示例
python3 工具/生成视频素材.py 项目/橘猫和白猫/剧集/第五集_新剧/
```

**固定参数**：
- 模型：`MiniMax-Hailuo-02`
- 分辨率：`512P`
- 时长：`6秒`
- 费用：`0.60元/条`（两条1.2元）

**输出**：
- `橘猫说话.mp4` - 橘猫说话，白猫闭嘴听
- `白猫说话.mp4` - 白猫说话，橘猫闭嘴听

---

### 3. 生成TTS.py

从剧本文件生成TTS语音，并保存剧本.json。

```bash
python3 工具/生成TTS.py <剧集目录> <剧本文件>

# 示例
python3 工具/生成TTS.py 项目/橘猫和白猫/剧集/第五集_新剧/ 剧本.txt
```

**剧本格式**（纯文本）：
```
【橘猫】媳妇儿，今天天气不错！
【白猫】是啊，适合出去浪。
【橘猫】走，哥带你买包去！
```

**输出**：
- `音频/01_橘猫.mp3`、`02_白猫.mp3`...
- `剧本.json`（唯一数据源）

**TTS引擎**：
- 橘猫：`zh-CN-YunjianNeural`（男声，体育风格，热情有力）
- 白猫：`zh-CN-XiaoyiNeural`（女声）

---

### 4. 合成脚本.py

从剧本.json合成最终视频。

```bash
python3 工具/合成脚本.py <剧集目录>

# 示例
python3 工具/合成脚本.py 项目/橘猫和白猫/剧集/第五集_新剧/
```

**前置条件**：
```
剧集目录/
├── 剧本.json        # 必需
├── 橘猫说话.mp4     # 必需
├── 白猫说话.mp4     # 必需
└── 音频/            # 必需
    ├── 01_*.mp3
    └── ...
```

**功能**：
- 从剧本.json读取台词
- 根据角色选择视频
- 自动循环视频适配音频长度
- 添加字幕（自适应字体大小）
- 拼接输出

**输出**：
- `成品/标题_demo.mp4`

---

## 剧本.json 格式

TTS生成和视频合成的**唯一数据源**。

```json
{
  "title": "剧集标题",
  "characters": {
    "A": {"name": "橘猫", "video": "橘猫说话.mp4"},
    "B": {"name": "白猫", "video": "白猫说话.mp4"}
  },
  "dialogue": [
    {"audio": "01_橘猫.mp3", "character": "橘猫", "text": "台词内容"},
    {"audio": "02_白猫.mp3", "character": "白猫", "text": "台词内容"}
  ]
}
```

---

## 依赖

| 依赖 | 安装方式 |
|------|----------|
| Python 3 | 系统自带 |
| edge-tts | `pip install edge-tts` |
| ffmpeg | `brew install ffmpeg` |
| Node.js | MiniMax视频生成需要 |

---

## 费用估算

| 步骤 | 费用 |
|------|------|
| 视频素材（2条） | 1.2元 |
| TTS | 免费 |
| 合成 | 免费 |
| **总计** | **1.2元/集** |

---

*更新：2026-01-25*
